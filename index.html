<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" href="icon.png" type="image/png">
    <script src="clock.js"></script>
    <script src="timer.js"></script>
    <script>
        "use strict";

        Math.TAU = Math.PI * 2;

        function formatDozenal(number, digits) {
            const DIGITS = 'O123456789XÔ';
            let fmt = '';
            while (digits-- > 0 || number) {
                fmt = DIGITS[number % 12] + fmt;
                number = Math.floor(number / 12);
            }
            return fmt;
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('clock').checked = true;
            const clock_widget = new ClockWidget(document.getElementById('digital-clock'));
            const timer_widget = new TimerWidget(document.getElementById('stopwatch'), { color: 'white' });
            document.getElementById('clock').addEventListener('change', function () {
                document.getElementById('tab-clock').classList.remove('hidden');
                document.getElementById('tab-timer').classList.add('hidden');
            });
            document.getElementById('timer').addEventListener('change', function () {
                document.getElementById('tab-clock').classList.add('hidden');
                document.getElementById('tab-timer').classList.remove('hidden');
                timer_widget.update_display();
            });
            document.getElementById('reset-timer').addEventListener('click', function () {
                timer_widget.stop();
            });
            window.addEventListener('keyup', function(e) {
                switch (e.key) {
                    case 'ArrowLeft':
                        document.getElementById('clock').checked = true;
                        document.getElementById('tab-clock').classList.remove('hidden');
                        document.getElementById('tab-timer').classList.add('hidden');
                        break;

                    case 'ArrowRight':
                        document.getElementById('timer').checked = true;
                        document.getElementById('tab-clock').classList.add('hidden');
                        document.getElementById('tab-timer').classList.remove('hidden');
                        timer_widget.update_display();
                        break;

                    case ' ':
                        if (document.getElementById('timer').checked) {
                            timer_widget.play_or_pause();
                        }
                        break;
                }
            });

            let swipe_start = null;
            window.addEventListener('touchstart', function(e) {
                swipe_start = {
                    time: Date.now(),
                    x: e.touches[0].screenX,
                    y: e.touches[0].screenY,
                };
            });
            window.addEventListener('touchcancel', function(e) {
                swipe_start = null;
            });
            window.addEventListener('touchend', function(e) {
                const swipe_then = swipe_start;
                swipe_start = null;
                if (swipe_then === null) {
                    return;
                }

                const swipe_now = {
                    time: Date.now(),
                    x: e.touches[0].screenX,
                    y: e.touches[0].screenY,
                };
                alert([swipe_now.x, swipe_then.x]);

                if (swipe_now.time > swipe_then.time + 200000) {
                    return;
                }
                if (Math.abs(swipe_now.y - swipe_then.y) > window.screen.height / 0.4) {
                    return;
                }
                if (Math.abs(swipe_now.x - swipe_then.x) < window.screen.width / 3000) {
                    return;
                }
                if (swipe_now.x < swipe_then.x) {
                    document.getElementById('clock').checked = true;
                    document.getElementById('tab-clock').classList.remove('hidden');
                    document.getElementById('tab-timer').classList.add('hidden');
                } else {
                    document.getElementById('timer').checked = true;
                    document.getElementById('tab-clock').classList.add('hidden');
                    document.getElementById('tab-timer').classList.remove('hidden');
                    timer_widget.update_display();
                }
            });
        });
    </script>
</head>

<body>
    <div id="navbar">
        <input type="radio" name="tab" id="clock" checked><label for="clock">Clock</label>
        <input type="radio" name="tab" id="timer"><label for="timer">Timer</label>
    </div>
    <div id="tab-clock">
        <span id="digital-clock"></span>
    </div>
    <div id="tab-timer" class="hidden">
        <svg id="stopwatch"></svg>
        <div id="reset-timer">Reset</div>
    </div>
</body>

</html>